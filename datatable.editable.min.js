/*! Exportable 0.0.2
 * Â© 2017 Karl Saunders
 */
/**
 * @summary     Exportable
 * @description Vanilla-DataTables extension to allow for exporting to various formats
 * @version     0.0.2
 * @file        datatable.editable.js
 * @author      Karl Saunders
 * @contact     mobius1@gmx.com
 * @copyright   Copyright 2017 Karl Saunders
 *
 *
 * This source file is free software, available under the following license:
 *   MIT license - https://github.com/Mobius1/Vanilla-DataTables/blob/master/LICENSE
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: https://github.com/Mobius1/Vanilla-DataTables
 */
window.DataTable&&DataTable.extend("exportable",function(t,e,n){var i={download:!0,skipColumns:[],lineDelimiter:"\n",columnDelimiter:",",tableName:"table",replacer:null,space:4,modal:!0},o=function(){};return o.prototype.init=function(){this.initialised||(this.config=n.extend(i,e),this.initialised=!0)},o.prototype.export=function(t){switch(t&&n.isObject(t)&&(this.config=n.extend(this.config,t)),this.config.type.toLowerCase()){case"json":this.toJSON();break;case"sql":this.toSQL();break;case"csv":this.toCSV()}},o.prototype.toJSON=function(e){e&&n.isObject(e)&&(this.config=n.extend(this.config,e)),this.config.type="json";var i="",o=[],s=this.config,c=t.table;return n.each(c.rows,function(t,e){o[e]=o[e]||{},n.each(t.cells,function(t,n){!t.hidden&&s.skipColumns.indexOf(t.index)<0&&(o[e][c.header.cells[t.index].content]=c.rows[e].cells[t.index].content)})}),i=JSON.stringify(o,s.replacer,s.space),s.download&&(this.string="data:application/json;charset=utf-8,"+i,this.download()),i},o.prototype.toCSV=function(e){e&&n.isObject(e)&&(this.config=n.extend(this.config,e)),this.config.type="csv";var i="",o=[],s=this.config,c=t.table;n.each(c.rows,function(t,e){o[e]=o[e]||{},n.each(t.cells,function(t,e){!t.hidden&&s.skipColumns.indexOf(t.index)<0&&(i+=t.content+s.columnDelimiter)}),i=i.trim().substring(0,i.length-1),i+=s.lineDelimiter}),i=i.trim().substring(0,i.length-1),s.download&&(this.string="data:text/csv;charset=utf-8,"+i,this.download())},o.prototype.toSQL=function(e){e&&n.isObject(e)&&(this.config=n.extend(this.config,e)),this.config.type="sql";var i=this.config,o=t.table,s="INSERT INTO `"+i.tableName+"` (";return n.each(o.header.cells,function(t){!t.hidden&&i.skipColumns.indexOf(t.index)<0&&(s+="`"+t.content+"`,")}),s=s.trim().substring(0,s.length-1),s+=") VALUES ",n.each(o.rows,function(t){s+="(",n.each(t.cells,function(t){!t.hidden&&i.skipColumns.indexOf(t.index)<0&&(s+="`"+t.content+"`,")}),s=s.trim().substring(0,s.length-1),s+="),"}),s=s.trim().substring(0,s.length-1),s+=";",i.download&&(this.string="data:application/sql;charset=utf-8,"+s,this.download()),s},o.prototype.download=function(t){if(this.string){this.config.filename=this.config.filename||"datatable_export",this.config.filename+="."+this.config.type,this.string=encodeURI(this.string);var e=document.createElement("a");e.href=this.string,e.download=this.config.filename,document.body.appendChild(e),e.click(),document.body.removeChild(e)}},o.prototype.print=function(e){e&&n.isObject(e)&&(this.config=n.extend(this.config,e));var i=document.createElement("table"),o=document.createElement("thead"),s=document.createElement("tbody");i.appendChild(o),i.appendChild(s),n.each(t.table.header.cells,function(t){o.appendChild(t.node.cloneNode(!0))}),n.each(t.table.rows,function(t){s.appendChild(t.node.cloneNode(!0))});var c=window.open();c.document.body.appendChild(i),this.config.modal&&(c.focus(),c.print())},new o});