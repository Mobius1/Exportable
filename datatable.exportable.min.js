/*! Exportable 0.0.7
 * Â© 2017 Karl Saunders
 */
/**
 * @summary     Exportable
 * @description Vanilla-DataTables extension to allow for exporting to various formats
 * @version     0.0.7
 * @file        datatable.exportable.js
 * @author      Karl Saunders
 * @contact     mobius1@gmx.com
 * @copyright   Copyright 2017 Karl Saunders
 *
 *
 * This source file is free software, available under the following license:
 *   MIT license - https://github.com/Mobius1/Vanilla-DataTables/blob/master/LICENSE
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: https://github.com/Mobius1/Vanilla-DataTables
 */
window.DataTable&&DataTable.extend("exportable",function(e,t,n){var i={download:!0,skipColumns:[],escapeHTML:!0,lineDelimiter:"\n",columnDelimiter:",",includeHeadings:!0,tableName:"table",replacer:null,space:4,modal:!0},o=function(){};return o.prototype.init=function(){this.initialised||(this.config=n.extend(i,t),this.initialised=!0)},o.prototype.getRows=function(t){var i=[];return(t=t||this.config).pages?isNaN(t.pages)?Array.isArray(t.pages)&&n.each(t.pages,function(t){i=i.concat(e.pages[t-1])}):i=i.concat(e.pages[t.pages-1]):i=i.concat(e.table.rows),i},o.prototype.getConfig=function(e){return e&&n.isObject(e)?n.extend(n.extend({},this.config),e):this.config},o.prototype.stripHTML=function(e){return e.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?(\/)?>|<\/\w+>/gi,"")},o.prototype.export=function(e){switch((e=this.getConfig(e)).type.toLowerCase()){case"json":this.toJSON(e);break;case"sql":this.toSQL(e);break;case"csv":this.toCSV(e)}},o.prototype.toJSON=function(t){(t=this.getConfig(t)).type="json";var i="",o=[],a=t,s=e.table,c=this.getRows(t);return n.each(c,function(e,t){o[t]=o[t]||{},n.each(e.cells,function(e,n){!e.hidden&&a.skipColumns.indexOf(e.index)<0&&(o[t][s.header.cells[e.index].content]=c[t].cells[e.index].content)})}),i=JSON.stringify(o,a.replacer,a.space),t.escapeHTML&&(i=this.stripHTML(i)),a.download&&(i="data:application/json;charset=utf-8,"+i,this.download(i,t)),i},o.prototype.toCSV=function(t){(t=this.getConfig(t)).type="csv";var i=[],o=[],a=t,s=e.table,c=this.getRows(t);return t.includeHeadings&&(n.each(s.header.cells,function(e){!e.hidden&&a.skipColumns.indexOf(e.index)<0&&(i+=e.content+a.columnDelimiter)}),i=i.trim().substring(0,i.length-1),i+=a.lineDelimiter),n.each(c,function(e,t){o[t]=o[t]||{},n.each(e.cells,function(e,t){!e.hidden&&a.skipColumns.indexOf(e.index)<0&&(i+=e.content+a.columnDelimiter)}),i=i.trim().substring(0,i.length-1),i+=a.lineDelimiter}),i=i.trim().substring(0,i.length-1),t.escapeHTML&&(i=this.stripHTML(i)),a.download&&(i="data:text/csv;charset=utf-8,"+i,this.download(i,t)),i},o.prototype.toSQL=function(t){(t=this.getConfig(t)).type="sql";var i=t,o=e.table,a=this.getRows(t),s="INSERT INTO `"+i.tableName+"` (";return n.each(o.header.cells,function(e){!e.hidden&&i.skipColumns.indexOf(e.index)<0&&(s+="`"+e.content+"`,")}),s=s.trim().substring(0,s.length-1),s+=") VALUES ",n.each(a,function(e){s+="(",n.each(e.cells,function(e){!e.hidden&&i.skipColumns.indexOf(e.index)<0&&(s+="`"+e.content+"`,")}),s=s.trim().substring(0,s.length-1),s+="),"}),s=s.trim().substring(0,s.length-1),s+=";",t.escapeHTML&&(s=this.stripHTML(s)),i.download&&(s="data:application/sql;charset=utf-8,"+s,this.download(s,t)),s},o.prototype.download=function(e,t){if(e){var n=t.filename||"datatable_export";n+="."+t.type,e=encodeURI(e);var i=document.createElement("a");i.href=e,i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i)}},o.prototype.print=function(t){t&&n.isObject(t)&&(t=n.extend(this.config,t));var i=document.createElement("table"),o=document.createElement("thead"),a=document.createElement("tbody");i.appendChild(o),i.appendChild(a),n.each(e.table.header.cells,function(e){o.appendChild(e.node.cloneNode(!0))}),n.each(e.table.rows,function(e){a.appendChild(e.node.cloneNode(!0))});var s=window.open();s.document.body.appendChild(i),t.modal&&(s.focus(),s.print())},o.prototype.destroy=function(){this.initialised&&(this.initialised=!1)},new o});